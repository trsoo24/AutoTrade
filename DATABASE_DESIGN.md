# 모의 투자 시스템 데이터베이스 설계

## 📊 전체 아키텍처

```
┌─────────────────┐    ┌─────────────────┐
│   MySQL (RDB)   │    │  MongoDB (NoSQL) │
│                 │    │                 │
│ • 사용자 관리    │    │ • 시세 데이터    │
│ • 계좌 관리      │    │ • 기술적 지표    │
│ • 거래 내역      │    │ • 뉴스 데이터    │
│ • 백트래킹 결과  │    │ • API 로그      │
│ • 시스템 로그    │    │                 │
└─────────────────┘    └─────────────────┘
```

## 🗄️ MySQL 테이블 설계

### 1. 사용자 관리 (users)
- **목적**: 사용자 계정 및 개인정보 관리
- **주요 필드**: 사용자 ID, 사용자명, 이메일, 비밀번호 해시, 개인정보
- **특징**: 이메일과 사용자명은 유니크 제약조건

### 2. 계좌 관리 (accounts)
- **목적**: 사용자별 거래 계좌 관리
- **주요 필드**: 계좌번호, 잔고 정보, 수익/손실, 수수료
- **특징**: 여러 계좌 타입 지원 (주식, 선물, 옵션, 마진)

### 3. 주식 종목 정보 (stocks)
- **목적**: 상장 종목 기본 정보 관리
- **주요 필드**: 종목코드, 종목명, 시장구분, 섹터, 기업정보
- **특징**: 상장/상폐 이력 관리

### 4. 주식 보유 현황 (stock_positions)
- **목적**: 계좌별 종목 보유 현황 및 수익/손실 관리
- **주요 필드**: 보유수량, 평균단가, 평가손익, 실현손익
- **특징**: 계좌-종목 조합 유니크 제약조건

### 5. 주문 관리 (orders)
- **목적**: 매수/매도 주문 관리
- **주요 필드**: 주문타입, 수량, 가격, 주문상태, 체결수량`
- **특징**: 주문 상태 추적 (대기, 부분체결, 체결, 취소, 거부)

### 6. 체결 내역 (trades)
- **목적**: 실제 거래 체결 내역 관리
- **주요 필드**: 체결가격, 수량, 수수료, 세금, 총금액
- **특징**: 주문과 1:N 관계, 체결번호 유니크

### 7. 거래 전략 관리 (trading_strategies)
- **목적**: 사용자별 거래 전략 저장 및 관리
- **주요 필드**: 전략명, 전략타입, 파라미터 (JSON)
- **특징**: 다양한 전략 타입 지원 (SMA, RSI, MACD 등)

### 8. 백트래킹 결과 (backtest_results)
- **목적**: 백트래킹 실행 결과 및 성과 지표 저장
- **주요 필드**: 수익률, 승률, 최대낙폭, 샤프비율, 거래횟수`
- **특징**: 포괄적인 성과 분석 지표 포함

### 9. 백트래킹 거래 내역 (backtest_trades)
- **목적**: 백트래킹 중 발생한 모든 거래 내역
- **주요 필드**: 거래일자, 거래타입, 가격, 수량, 누적손익
- **특징**: 백트래킹 결과와 1:N 관계

### 10. 알림 설정 (notifications)
- **목적**: 사용자별 알림 관리
- **주요 필드**: 알림타입, 제목, 내용, 읽음여부
- **특징**: 다양한 알림 타입 지원

### 11. 시스템 로그 (system_logs)
- **목적**: 시스템 활동 및 오류 로그
- **주요 필드**: 로그레벨, 카테고리, 메시지, 상세정보 (JSON)
- **특징**: 사용자 활동 추적 및 디버깅

### 12. 시장 데이터 캐시 (market_data_cache)
- **목적**: 최근 시장 데이터 캐싱 (빠른 조회용)
- **주요 필드**: OHLCV 데이터, 변동률, 시가총액
- **특징**: 종목-날짜 조합 유니크 제약조건

## 📈 MongoDB 컬렉션 설계

### 1. 주식 시세 데이터 (stock_prices)
- **목적**: 일별/분별 시세 데이터 저장
- **특징**: 대용량 시계열 데이터, 빠른 조회를 위한 인덱스

### 2. 분별 시세 데이터 (intraday_prices)
- **목적**: 실시간 분별 가격 데이터
- **특징**: 실시간 거래 분석용

### 3. 기술적 지표 데이터 (technical_indicators)
- **목적**: 계산된 기술적 지표 저장
- **특징**: 다양한 지표와 파라미터 조합

### 4. 시장 요약 정보 (market_summary)
- **목적**: 전체 시장 지표 및 통계
- **특징**: 상승/하락 종목 수 등 시장 동향

### 5. 주식 관련 뉴스 (stock_news)
- **목적**: 종목별 뉴스 및 감정 분석
- **특징**: 뉴스 감정 분석 결과 포함

### 6. API 호출 로그 (api_logs)
- **목적**: 외부 API 호출 이력 및 성능 모니터링
- **특징**: 요청/응답 데이터, 응답시간 추적

## 🔄 데이터 플로우

### 1. 시세 데이터 수집
```
한국투자증권 API → MongoDB (stock_prices) → MySQL (market_data_cache)
```

### 2. 거래 실행
```
사용자 주문 → MySQL (orders) → 체결 → MySQL (trades) → MySQL (stock_positions)
```

### 3. 백트래킹
```
MongoDB (stock_prices) → 백트래킹 엔진 → MySQL (backtest_results, backtest_trades)
```

### 4. 성과 분석
```
MySQL (trades, backtest_results) → 분석 엔진 → 대시보드
```

## 🎯 설계 특징

### 1. 확장성
- **수평 확장**: MongoDB로 대용량 시세 데이터 처리
- **수직 확장**: MySQL로 정규화된 거래 데이터 관리

### 2. 성능 최적화
- **인덱스 전략**: 조회 패턴에 맞는 복합 인덱스
- **파티셔닝**: 시계열 데이터 시간별 파티셔닝 가능
- **캐싱**: 자주 조회되는 데이터 캐시 테이블

### 3. 데이터 무결성
- **외래키 제약조건**: 참조 무결성 보장
- **트랜잭션**: 거래 관련 데이터 일관성
- **유니크 제약조건**: 중복 데이터 방지

### 4. 모니터링 및 로깅
- **API 로그**: 외부 API 호출 추적
- **시스템 로그**: 애플리케이션 활동 모니터링
- **성능 지표**: 응답시간, 오류율 추적

## 🚀 구현 우선순위

### Phase 1: 기본 구조
1. 사용자/계좌 관리 테이블
2. 주식 종목 정보 테이블
3. 기본 거래 테이블 (orders, trades)

### Phase 2: 거래 기능
1. 주식 보유 현황 테이블
2. 시장 데이터 캐시 테이블
3. MongoDB 시세 데이터 수집

### Phase 3: 고급 기능
1. 백트래킹 관련 테이블
2. 거래 전략 관리
3. 알림 및 로깅 시스템

### Phase 4: 최적화
1. 인덱스 최적화
2. 파티셔닝 적용
3. 성능 모니터링 